<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Proxying Ethernet in HTTP</title>
<meta content="Alejandro R Sedeño" name="author">
<meta content="
       This document describes how to proxy Ethernet frames in HTTP. This protocol
is similar to IP proxying in HTTP, but for Layer 2 instead of Layer 3. More
specifically, this document defines a protocol that allows an HTTP client to
create Layer 2 Ethernet tunnel through an HTTP server to an attached
physical or virtual Ethernet segment. 
    " name="description">
<meta content="xml2rfc 3.29.0" name="generator">
<meta content="quic" name="keyword">
<meta content="http" name="keyword">
<meta content="datagram" name="keyword">
<meta content="VPN" name="keyword">
<meta content="proxy" name="keyword">
<meta content="tunnels" name="keyword">
<meta content="masque" name="keyword">
<meta content="http-ng" name="keyword">
<meta content="layer-2" name="keyword">
<meta content="ethernet" name="keyword">
<meta content="draft-ietf-masque-connect-ethernet-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.29.0
    Python 3.12.11
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 5.3.1
    platformdirs 4.3.8
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.4
    setuptools 80.9.0
    wcwidth 0.2.13
-->
<link href="draft-ietf-masque-connect-ethernet.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">CONNECT-ETHERNET</td>
<td class="right">July 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Sedeño</td>
<td class="center">Expires 6 January 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Multiplexed Application Substrate over QUIC Encryption</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-masque-connect-ethernet-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-07-05" class="published">5 July 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-01-06">6 January 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. R. Sedeño</div>
<div class="org">Google LLC</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Proxying Ethernet in HTTP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes how to proxy Ethernet frames in HTTP. This protocol
is similar to IP proxying in HTTP, but for Layer 2 instead of Layer 3. More
specifically, this document defines a protocol that allows an HTTP client to
create Layer 2 Ethernet tunnel through an HTTP server to an attached
physical or virtual Ethernet segment.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://ietf-wg-masque.github.io/draft-ietf-masque-connect-ethernet/draft-ietf-masque-connect-ethernet.html">https://ietf-wg-masque.github.io/draft-ietf-masque-connect-ethernet/draft-ietf-masque-connect-ethernet.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-ietf-masque-connect-ethernet/">https://datatracker.ietf.org/doc/draft-ietf-masque-connect-ethernet/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        MASQUE Working Group mailing list (<span><a href="mailto:masque@ietf.org">mailto:masque@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/masque/">https://mailarchive.ietf.org/arch/browse/masque/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/masque/">https://www.ietf.org/mailman/listinfo/masque/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/ietf-wg-masque/draft-ietf-masque-connect-ethernet">https://github.com/ietf-wg-masque/draft-ietf-masque-connect-ethernet</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 6 January 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-configuration-of-clients" class="internal xref">Configuration of Clients</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-tunnelling-ethernet-over-ht" class="internal xref">Tunnelling Ethernet over HTTP</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-ethernet-proxy-handling" class="internal xref">Ethernet Proxy Handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-http-11-request" class="internal xref">HTTP/1.1 Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-http-11-response" class="internal xref">HTTP/1.1 Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-http-2-and-http-3-requests" class="internal xref">HTTP/2 and HTTP/3 Requests</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-http-2-and-http-3-responses" class="internal xref">HTTP/2 and HTTP/3 Responses</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-context-identifiers" class="internal xref">Context Identifiers</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-http-datagram-payload-forma" class="internal xref">HTTP Datagram Payload Format</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-ethernet-frame-handling" class="internal xref">Ethernet Frame Handling</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-examples" class="internal xref">Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-remote-access-l2vpn" class="internal xref">Remote Access L2VPN</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-site-to-site-l2vpn" class="internal xref">Site-to-Site L2VPN</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-performance-considerations" class="internal xref">Performance Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-mtu-and-frame-ordering-cons" class="internal xref">MTU and Frame Ordering Considerations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-ieee-8021q-vlan-tagging" class="internal xref">IEEE 802.1Q VLAN tagging</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-http-upgrade-token" class="internal xref">HTTP Upgrade Token</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-updates-to-the-masque-uri-s" class="internal xref">Updates to the MASQUE URI Suffixes Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">HTTP provides the CONNECT method (see <span><a href="https://rfc-editor.org/rfc/rfc9110#section-9.3.6" class="relref">Section 9.3.6</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>) for
creating a TCP <span>[<a href="#TCP" class="cite xref">TCP</a>]</span> tunnel to a destination, a similar mechanism for
UDP <span>[<a href="#CONNECT-UDP" class="cite xref">CONNECT-UDP</a>]</span>, and an additional mechanism for IP
<span>[<a href="#CONNECT-IP" class="cite xref">CONNECT-IP</a>]</span>. However, these mechanisms can't carry Layer 2 frames
without further encapsulation inside of IP, for instance with EtherIP
<span>[<a href="#ETHERIP" class="cite xref">ETHERIP</a>]</span>, GUE <span>[<a href="#GUE" class="cite xref">GUE</a>]</span> or L2TP
<span>[<a href="#L2TP" class="cite xref">L2TP</a>]</span> <span>[<a href="#L2TPv3" class="cite xref">L2TPv3</a>]</span>, which imposes an additional MTU cost.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This document describes a protocol for exchanging Ethernet frames with an HTTP
server. Either participant in the HTTP connection can then relay Ethernet
frames to and from a local or virtual interface, allowing the bridging of two
Ethernet broadcast domains to establish a Layer 2 VPN. This can simplify
connectivity to network-connected appliances that are configured to only
interact with peers on the same Ethernet broadcast domain.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This protocol supports all existing versions of HTTP by using HTTP Datagrams
<span>[<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>. When using HTTP/2 <span>[<a href="#H2" class="cite xref">HTTP/2</a>]</span> or HTTP/3 <span>[<a href="#H3" class="cite xref">HTTP/3</a>]</span>, it uses
HTTP Extended CONNECT as described in <span>[<a href="#EXT-CONNECT2" class="cite xref">EXT-CONNECT2</a>]</span> and
<span>[<a href="#EXT-CONNECT3" class="cite xref">EXT-CONNECT3</a>]</span>. When using HTTP/1.x <span>[<a href="#H1" class="cite xref">HTTP/1.1</a>]</span>, it uses HTTP Upgrade as
defined in <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.8" class="relref">Section 7.8</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This protocol necessarily involves additional framing overhead. When possible,
users should use higher-level proxying protocols, such as connect-ip or
connect-udp.<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">In this document, we use the term "Ethernet proxy" to refer to the HTTP server
that responds to the Ethernet proxying request. The term "client" is used in the
HTTP sense; the client constructs the Ethernet proxying request. If there are
HTTP intermediaries (as defined in <span><a href="https://rfc-editor.org/rfc/rfc9110#section-3.7" class="relref">Section 3.7</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>) between the client
and the Ethernet proxy, those are referred to as "intermediaries" in this
document. The term "Ethernet proxying endpoints" refers to both the client and
the Ethernet proxy.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">This document uses terminology from <span>[<a href="#QUIC" class="cite xref">QUIC</a>]</span>. Where this document
defines protocol types, the definition format uses the notation from <span><a href="https://rfc-editor.org/rfc/rfc9000#section-1.3" class="relref">Section 1.3</a> of [<a href="#QUIC" class="cite xref">QUIC</a>]</span>. This specification uses the variable-length integer encoding
from <span><a href="https://rfc-editor.org/rfc/rfc9000#section-16" class="relref">Section 16</a> of [<a href="#QUIC" class="cite xref">QUIC</a>]</span>. Variable-length integer values do not
need to be encoded in the minimum number of bytes necessary.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Note that, when the HTTP version in use does not support multiplexing streams
(such as HTTP/1.1), any reference to "stream" in this document represents the
entire connection.<a href="#section-2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-config">
<section id="section-3">
      <h2 id="name-configuration-of-clients">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-configuration-of-clients" class="section-name selfRef">Configuration of Clients</a>
      </h2>
<p id="section-3-1">Clients are configured to use Ethernet proxying over HTTP via a URI Template
<span>[<a href="#TEMPLATE" class="cite xref">TEMPLATE</a>]</span>. The URI Templates used by this protocol do not require
any variables; implementations or extensions <span class="bcp14">MAY</span> specify their own. URI
Templates specified for this protocol <span class="bcp14">MAY</span> use the well-known location
<span>[<a href="#WELL-KNOWN" class="cite xref">WELL-KNOWN</a>]</span> registered by this document.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">Examples are shown below:<a href="#section-3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-3">
<pre>
https://example.org/.well-known/masque/ethernet/
https://proxy.example.org:4443/masque/ethernet/
https://masque.example.org/?user=bob
</pre><a href="#section-3-3" class="pilcrow">¶</a>
</div>
<p id="section-3-4">An implementation that supports connecting to different Ethernet segments might
add a "vlan-identifier" variable to specify which segment to connect to. The
optionality of variables needs to be considered when defining the template so
that variables are either self-identifying or possible to exclude in the syntax.
How valid values for such variables are communicated to the client is not a part
of this protocol.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">Hypothetical examples are shown below:<a href="#section-3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-6">
<pre>
https://proxy.example.org:4443/masque/ethernet?vlan={vlan-identifier}
https://etherproxy.example.org/{vlan-identifier}
</pre><a href="#section-3-6" class="pilcrow">¶</a>
</div>
<p id="section-3-7">The following requirements apply to the URI Template:<a href="#section-3-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-8.1">
          <p id="section-3-8.1.1">The URI Template <span class="bcp14">MUST</span> be a level 3 template or lower.<a href="#section-3-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-8.2">
          <p id="section-3-8.2.1">The URI Template <span class="bcp14">MUST</span> be in absolute form and <span class="bcp14">MUST</span> include non-empty scheme,
authority, and path components.<a href="#section-3-8.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-8.3">
          <p id="section-3-8.3.1">The path component of the URI Template <span class="bcp14">MUST</span> start with a slash "/".<a href="#section-3-8.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-8.4">
          <p id="section-3-8.4.1">All template variables <span class="bcp14">MUST</span> be within the path or query components of the URI.<a href="#section-3-8.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-8.5">
          <p id="section-3-8.5.1">The URI Template <span class="bcp14">MUST NOT</span> contain any non-ASCII Unicode characters and <span class="bcp14">MUST</span>
only contain ASCII characters in the range 0x21-0x7E inclusive (note that
percent-encoding is allowed; see <span><a href="https://rfc-editor.org/rfc/rfc3986#section-2.1" class="relref">Section 2.1</a> of [<a href="#URI" class="cite xref">URI</a>]</span>).<a href="#section-3-8.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-3-8.6">
          <p id="section-3-8.6.1">The URI Template <span class="bcp14">MUST NOT</span> use Reserved Expansion ("+" operator), Fragment
Expansion ("#" operator), Label Expansion with Dot-Prefix, Path Segment
Expansion with Slash-Prefix, nor Path-Style Parameter Expansion with
Semicolon-Prefix.<a href="#section-3-8.6.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-3-9">Clients <span class="bcp14">SHOULD</span> validate the requirements above; however, clients <span class="bcp14">MAY</span> use a
general-purpose URI Template implementation that lacks this specific
validation. If a client detects that any of the requirements above are not met
by a URI Template, the client <span class="bcp14">MUST</span> reject its configuration and abort the
request without sending it to the Ethernet proxy.<a href="#section-3-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tunnelling-ethernet-over-http">
<section id="section-4">
      <h2 id="name-tunnelling-ethernet-over-ht">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-tunnelling-ethernet-over-ht" class="section-name selfRef">Tunnelling Ethernet over HTTP</a>
      </h2>
<p id="section-4-1">To allow negotiation of a tunnel for Ethernet over HTTP, this document defines
the "connect-ethernet" HTTP upgrade token. The resulting Ethernet tunnels use the
Capsule Protocol (see <span><a href="https://rfc-editor.org/rfc/rfc9297#section-3.2" class="relref">Section 3.2</a> of [<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>) with HTTP Datagrams in the
format defined in <a href="#payload-format" class="auto internal xref">Section 6</a>.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">To initiate an Ethernet tunnel associated with a single HTTP stream, a client
issues a request containing the "connect-ethernet" upgrade token.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">By virtue of the definition of the Capsule Protocol (see <span><a href="https://rfc-editor.org/rfc/rfc9297#section-3.2" class="relref">Section 3.2</a> of [<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>), Ethernet proxying requests do not carry any message content.
Similarly, successful Ethernet proxying responses also do not carry any message
content.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Ethernet proxying over HTTP <span class="bcp14">MUST</span> be operated over TLS or QUIC encryption, or another
equivalent encryption protocol, to provide confidentiality, integrity, and
authentication.<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="ethernet-proxy-handling">
<section id="section-4.1">
        <h3 id="name-ethernet-proxy-handling">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-ethernet-proxy-handling" class="section-name selfRef">Ethernet Proxy Handling</a>
        </h3>
<p id="section-4.1-1">Upon receiving an Ethernet proxying request:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">If the recipient is configured to use another HTTP proxy, it will act as an
intermediary by forwarding the request to another HTTP server. Note that
such intermediaries may need to re-encode the request if they forward it
using a version of HTTP that is different from the one used to receive it,
as the request encoding differs by version (see below).<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">Otherwise, the recipient will act as an Ethernet proxy. The Ethernet proxy
can choose to reject the Ethernet proxying request or establish an Ethernet
tunnel.<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-3">The lifetime of the Ethernet tunnel is tied to the Ethernet proxying request
stream.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">A successful response (as defined in Sections <a href="#resp1" class="auto internal xref">4.3</a> and <a href="#resp23" class="auto internal xref">4.5</a>)
indicates that the Ethernet proxy has established an Ethernet tunnel and is
willing to proxy Ethernet frames. Any response other than a successful response
indicates that the request has failed; thus, the client <span class="bcp14">MUST</span> abort the request.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="req1">
<section id="section-4.2">
        <h3 id="name-http-11-request">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-http-11-request" class="section-name selfRef">HTTP/1.1 Request</a>
        </h3>
<p id="section-4.2-1">When using HTTP/1.1 <span>[<a href="#H1" class="cite xref">HTTP/1.1</a>]</span>, an Ethernet proxying request will meet the following
requirements:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">
            <p id="section-4.2-2.1.1">The method <span class="bcp14">SHALL</span> be "GET".<a href="#section-4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.2">
            <p id="section-4.2-2.2.1">The request <span class="bcp14">SHALL</span> include a single Host header field containing the host
and optional port of the Ethernet proxy.<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.3">
            <p id="section-4.2-2.3.1">The request <span class="bcp14">SHALL</span> include a Connection header field with value "Upgrade"
(note that this requirement is case-insensitive as per <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.6.1" class="relref">Section 7.6.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>).<a href="#section-4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-2.4">
            <p id="section-4.2-2.4.1">The request <span class="bcp14">SHALL</span> include an Upgrade header field with value "connect-ethernet".<a href="#section-4.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-3">An Ethernet proxying request that does not conform to these restrictions is
malformed. The recipient of such a malformed request <span class="bcp14">MUST</span> respond with an error
and <span class="bcp14">SHOULD</span> use the 400 (Bad Request) status code.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">For example, if the client is configured with the URI Template
"https://example.org/.well-known/masque/ethernet/" and wishes to open an
Ethernet tunnel, it could send the following request.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<span id="name-example-http-11-request"></span><div id="fig-req-h1">
<figure id="figure-1">
          <div class="lang-http-message sourcecode" id="section-4.2-5.1">
<pre>
GET https://example.org/.well-known/masque/ethernet/ HTTP/1.1
Host: example.org
Connection: Upgrade
Upgrade: connect-ethernet
Capsule-Protocol: ?1
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-example-http-11-request" class="selfRef">Example HTTP/1.1 Request</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="resp1">
<section id="section-4.3">
        <h3 id="name-http-11-response">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-http-11-response" class="section-name selfRef">HTTP/1.1 Response</a>
        </h3>
<p id="section-4.3-1">The server indicates success by replying with a response that conforms to the
following requirements:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-2.1">
            <p id="section-4.3-2.1.1">The HTTP status code on the response <span class="bcp14">SHALL</span> be 101 (Switching Protocols).<a href="#section-4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.2">
            <p id="section-4.3-2.2.1">The response <span class="bcp14">SHALL</span> include a Connection header field with value "Upgrade"
(note that this requirement is case-insensitive as per <span><a href="https://rfc-editor.org/rfc/rfc9110#section-7.6.1" class="relref">Section 7.6.1</a> of [<a href="#HTTP" class="cite xref">HTTP</a>]</span>).<a href="#section-4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.3">
            <p id="section-4.3-2.3.1">The response <span class="bcp14">SHALL</span> include a single Upgrade header field with value
"connect-ethernet".<a href="#section-4.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.4">
            <p id="section-4.3-2.4.1">The response <span class="bcp14">SHALL</span> meet the requirements of HTTP responses that start the
Capsule Protocol; see <span><a href="https://rfc-editor.org/rfc/rfc9297#section-3.2" class="relref">Section 3.2</a> of [<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>.<a href="#section-4.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.3-3">If any of these requirements are not met, the client <span class="bcp14">MUST</span> treat this proxying
attempt as failed and close the connection.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">For example, the server could respond with:<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<span id="name-example-http-11-response"></span><div id="fig-resp-h1">
<figure id="figure-2">
          <div class="lang-http-message sourcecode" id="section-4.3-5.1">
<pre>
HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: connect-ethernet
Capsule-Protocol: ?1
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-example-http-11-response" class="selfRef">Example HTTP/1.1 Response</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="req23">
<section id="section-4.4">
        <h3 id="name-http-2-and-http-3-requests">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-http-2-and-http-3-requests" class="section-name selfRef">HTTP/2 and HTTP/3 Requests</a>
        </h3>
<p id="section-4.4-1">When using HTTP/2 <span>[<a href="#H2" class="cite xref">HTTP/2</a>]</span> or HTTP/3 <span>[<a href="#H3" class="cite xref">HTTP/3</a>]</span>, Ethernet proxying requests use HTTP
Extended CONNECT. This requires that servers send an HTTP Setting as specified
in <span>[<a href="#EXT-CONNECT2" class="cite xref">EXT-CONNECT2</a>]</span> and <span>[<a href="#EXT-CONNECT3" class="cite xref">EXT-CONNECT3</a>]</span> and that requests use HTTP
pseudo-header fields with the following requirements:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">The :method pseudo-header field <span class="bcp14">SHALL</span> be "CONNECT".<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.2">
            <p id="section-4.4-2.2.1">The :protocol pseudo-header field <span class="bcp14">SHALL</span> be "connect-ethernet".<a href="#section-4.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.3">
            <p id="section-4.4-2.3.1">The :authority pseudo-header field <span class="bcp14">SHALL</span> contain the authority of the IP
proxy.<a href="#section-4.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.4-2.4">
            <p id="section-4.4-2.4.1">The :path and :scheme pseudo-header fields <span class="bcp14">SHALL NOT</span> be empty. Their values
<span class="bcp14">SHALL</span> contain the scheme and path from the configured URI Template; see
<a href="#client-config" class="auto internal xref">Section 3</a>.<a href="#section-4.4-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.4-3">An Ethernet proxying request that does not conform to these restrictions is
malformed; see <span><a href="https://rfc-editor.org/rfc/rfc9113#section-8.1.1" class="relref">Section 8.1.1</a> of [<a href="#H2" class="cite xref">HTTP/2</a>]</span> and <span><a href="https://rfc-editor.org/rfc/rfc9114#section-4.1.2" class="relref">Section 4.1.2</a> of [<a href="#H3" class="cite xref">HTTP/3</a>]</span>.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">For example, if the client is configured with the URI Template
"https://example.org/.well-known/masque/ethernet/" and wishes to open an
Ethernet tunnel, it could send the following request.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<span id="name-example-http-2-or-http-3-re"></span><div id="fig-req-h2">
<figure id="figure-3">
          <div class="lang-http-message sourcecode" id="section-4.4-5.1">
<pre>
HEADERS
:method = CONNECT
:protocol = connect-ethernet
:scheme = https
:path = /.well-known/masque/ethernet/
:authority = example.org
capsule-protocol = ?1
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-http-2-or-http-3-re" class="selfRef">Example HTTP/2 or HTTP/3 Request</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="resp23">
<section id="section-4.5">
        <h3 id="name-http-2-and-http-3-responses">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-http-2-and-http-3-responses" class="section-name selfRef">HTTP/2 and HTTP/3 Responses</a>
        </h3>
<p id="section-4.5-1">The server indicates success by replying with a response that conforms to the
following requirements:<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5-2.1">
            <p id="section-4.5-2.1.1">The HTTP status code on the response <span class="bcp14">SHALL</span> be in the 2xx (Successful) range.<a href="#section-4.5-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.5-2.2">
            <p id="section-4.5-2.2.1">The response <span class="bcp14">SHALL</span> meet the requirements of HTTP responses that start the
Capsule Protocol; see <span><a href="https://rfc-editor.org/rfc/rfc9297#section-3.2" class="relref">Section 3.2</a> of [<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>.<a href="#section-4.5-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.5-3">If any of these requirements are not met, the client <span class="bcp14">MUST</span> treat this proxying
attempt as failed and abort the request. As an example, any status code in the
3xx range will be treated as a failure and cause the client to abort the
request.<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5-4">For example, the server could respond with:<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<span id="name-example-http-2-or-http-3-res"></span><div id="fig-resp-h2">
<figure id="figure-4">
          <div class="lang-http-message sourcecode" id="section-4.5-5.1">
<pre>
HEADERS
:status = 200
capsule-protocol = ?1
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-http-2-or-http-3-res" class="selfRef">Example HTTP/2 or HTTP/3 Response</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="context-identifiers">
<section id="section-5">
      <h2 id="name-context-identifiers">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-context-identifiers" class="section-name selfRef">Context Identifiers</a>
      </h2>
<p id="section-5-1">The mechanism for proxying Ethernet in HTTP defined in this document allows
future extensions to exchange HTTP Datagrams that carry different semantics from
Ethernet frames. Some of these extensions could augment Ethernet payloads with
additional data or compress Ethernet frame header fields, while others could
exchange data that is completely separate from Ethernet payloads. In order to
accomplish this, all HTTP Datagrams associated with Ethernet proxying requests
streams start with a Context ID field; see <a href="#payload-format" class="auto internal xref">Section 6</a>.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Context IDs are 62-bit integers (0-2<sup>62</sup>-1). Context IDs are encoded as
variable-length integers; see <span><a href="https://rfc-editor.org/rfc/rfc9000#section-16" class="relref">Section 16</a> of [<a href="#QUIC" class="cite xref">QUIC</a>]</span>. The Context ID value of 0
is reserved for Ethernet payloads, while non-zero values are dynamically
allocated. Non-zero even-numbered Context-IDs are client allocated, and
odd-numbered Context IDs are proxy-allocated. The Context ID namespace is tied
to a given HTTP request; it is possible for a Context ID with the same numeric
value to be simultaneously allocated in distinct requests, potentially with
different semantics. Context IDs <span class="bcp14">MUST NOT</span> be re-allocated within a given HTTP
request but <span class="bcp14">MAY</span> be allocated in any order. The Context ID allocation
restrictions to the use of even-numbered and odd-numbered Context IDs exist in
order to avoid the need for synchronization between endpoints. However, once a
Context ID has been allocated, those restrictions do not apply to the use of the
Context ID; it can be used by either the client or the Ethernet proxy,
independent of which endpoint initially allocated it.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">Registration is the action by which an endpoint informs its peer of the
semantics and format of a given Context ID. This document does not define how
registration occurs. Future extensions <span class="bcp14">MAY</span> use HTTP header fields or capsules
to register Context IDs. Depending on the method being used, it is possible for
datagrams to be received with Context IDs that have not yet been registered.
For instance, this can be due to reordering of the packet containing the
datagram and the packet containing the registration message during transmission.<a href="#section-5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="payload-format">
<section id="section-6">
      <h2 id="name-http-datagram-payload-forma">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-http-datagram-payload-forma" class="section-name selfRef">HTTP Datagram Payload Format</a>
      </h2>
<p id="section-6-1">When associated with Ethernet proxying request streams, the HTTP Datagram
Payload field of HTTP Datagrams (see <span>[<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>) has the format defined in
<a href="#dgram-format" class="auto internal xref">Figure 5</a>. Note that when HTTP Datagrams are encoded using QUIC DATAGRAM
frames, the Context ID field defined below directly follows the Quarter Stream
ID field which is at the start of the QUIC DATAGRAM frame payload.<a href="#section-6-1" class="pilcrow">¶</a></p>
<span id="name-ethernet-proxying-http-data"></span><div id="dgram-format">
<figure id="figure-5">
        <div class="alignLeft art-text artwork" id="section-6-2.1">
<pre>
Ethernet Proxying HTTP Datagram Payload {
  Context ID (i),
  Payload (..),
}
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-ethernet-proxying-http-data" class="selfRef">Ethernet Proxying HTTP Datagram Format</a>
        </figcaption></figure>
</div>
<p id="section-6-3">The Ethernet Proxying HTTP Datagram Payload contains the following fields:<a href="#section-6-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-6-4">
        <dt id="section-6-4.1">Context ID:</dt>
        <dd style="margin-left: 1.5em" id="section-6-4.2">
          <p id="section-6-4.2.1">A variable-length integer that contains the value of the Context ID. If an
HTTP/3 datagram which carries an unknown Context ID is received, the receiver
<span class="bcp14">SHALL</span> either drop that datagram silently or buffer it temporarily (on the order
of a round trip) while awaiting the registration of the corresponding Context
ID.<a href="#section-6-4.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-6-4.3">Payload:</dt>
        <dd style="margin-left: 1.5em" id="section-6-4.4">
          <p id="section-6-4.4.1">The payload of the datagram, whose semantics depend on value of the previous
field. Note that this field can be empty.<a href="#section-6-4.4.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-6-5">Ethernet frames are encoded using HTTP Datagrams with the Context ID set to
zero. When the Context ID is set to zero, the Payload field contains a full
Layer 2 Ethernet Frame (from the MAC destination field until the last byte of
the Frame check sequence field), as defined by IEEE 802.3, with support for
optional IEEE 802.1Q tagging (see <a href="#vlan-recommendations" class="auto internal xref">Section 9.2</a>).<a href="#section-6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ethernet-frame-handling">
<section id="section-7">
      <h2 id="name-ethernet-frame-handling">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-ethernet-frame-handling" class="section-name selfRef">Ethernet Frame Handling</a>
      </h2>
<p id="section-7-1">This document defines a tunnelling mechanism that is conceptually an Ethernet
link. Implementations might need to handle some of the responsibilities of an
Ethernet switch or bridge if they do not delegate them to another implementation
such as a kernel. Those responsibilities are beyond the scope of this document,
and include, but are not limited to, the handling of broadcast packets and
multicast groups, or the local termination of PAUSE frames.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">If an Ethernet proxying endpoint fails to deliver a frame to an underlying
Ethernet segment, the endpoint <span class="bcp14">MUST</span> drop the frame.<a href="#section-7-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="examples">
<section id="section-8">
      <h2 id="name-examples">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="section-8-1">Ethernet proxying in HTTP enables the bridging of Ethernet broadcast domains.
These examples are provided to help illustrate some of the ways in which Ethernet
proxying can be used.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="example-remote">
<section id="section-8.1">
        <h3 id="name-remote-access-l2vpn">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-remote-access-l2vpn" class="section-name selfRef">Remote Access L2VPN</a>
        </h3>
<p id="section-8.1-1">The following example shows a point to point VPN setup where a client
appears to be connected to a remote Layer 2 network.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<span id="name-l2vpn-tunnel-setup"></span><div id="diagram-tunnel">
<figure id="figure-6">
          <div id="section-8.1-2.1">
            <div class="alignLeft art-svg artwork" id="section-8.1-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="128" width="520" viewBox="0 0 520 128" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 8,32 L 8,96" fill="none" stroke="black"></path>
                <path d="M 80,32 L 80,96" fill="none" stroke="black"></path>
                <path d="M 248,32 L 248,96" fill="none" stroke="black"></path>
                <path d="M 320,32 L 320,96" fill="none" stroke="black"></path>
                <path d="M 424,32 L 424,96" fill="none" stroke="black"></path>
                <path d="M 8,32 L 80,32" fill="none" stroke="black"></path>
                <path d="M 248,32 L 320,32" fill="none" stroke="black"></path>
                <path d="M 424,32 L 456,32" fill="none" stroke="black"></path>
                <path d="M 80,48 L 248,48" fill="none" stroke="black"></path>
                <path d="M 88,64 L 104,64" fill="none" stroke="black"></path>
                <path d="M 224,64 L 240,64" fill="none" stroke="black"></path>
                <path d="M 320,64 L 456,64" fill="none" stroke="black"></path>
                <path d="M 80,80 L 248,80" fill="none" stroke="black"></path>
                <path d="M 8,96 L 80,96" fill="none" stroke="black"></path>
                <path d="M 248,96 L 320,96" fill="none" stroke="black"></path>
                <path d="M 424,96 L 456,96" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="464,96 452,90.4 452,101.6" fill="black" transform="rotate(0,456,96)"></polygon>
                <polygon class="arrowhead" points="464,64 452,58.4 452,69.6" fill="black" transform="rotate(0,456,64)"></polygon>
                <polygon class="arrowhead" points="464,32 452,26.4 452,37.6" fill="black" transform="rotate(0,456,32)"></polygon>
                <polygon class="arrowhead" points="96,64 84,58.4 84,69.6" fill="black" transform="rotate(180,88,64)"></polygon>
                <g class="text">
                  <text x="484" y="36">HOST</text>
                  <text x="512" y="36">1</text>
                  <text x="284" y="52">L2</text>
                  <text x="360" y="52">Layer</text>
                  <text x="392" y="52">2</text>
                  <text x="44" y="68">Client</text>
                  <text x="128" y="68">Layer</text>
                  <text x="160" y="68">2</text>
                  <text x="196" y="68">Tunnel</text>
                  <text x="288" y="68">Proxy</text>
                  <text x="484" y="68">HOST</text>
                  <text x="512" y="68">2</text>
                  <text x="376" y="84">Broadcast</text>
                  <text x="364" y="100">Domain</text>
                  <text x="484" y="100">HOST</text>
                  <text x="512" y="100">3</text>
                </g>
              </svg><a href="#section-8.1-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-l2vpn-tunnel-setup" class="selfRef">L2VPN Tunnel Setup</a>
          </figcaption></figure>
</div>
<p id="section-8.1-3">In this case, the client connects to the Ethernet proxy and immediately can
start sending ethernet frames to the attached broadcast domain.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<span id="name-vpn-full-tunnel-example"></span><div id="fig-full-tunnel">
<figure id="figure-7">
          <div class="alignLeft art-text artwork" id="section-8.1-4.1">
<pre>
[[ From Client ]]             [[ From Ethernet Proxy ]]

SETTINGS
  H3_DATAGRAM = 1

                              SETTINGS
                                ENABLE_CONNECT_PROTOCOL = 1
                                H3_DATAGRAM = 1

STREAM(44): HEADERS
:method = CONNECT
:protocol = connect-ethernet
:scheme = https
:path = /.well-known/masque/ethernet/
:authority = proxy.example.com
capsule-protocol = ?1

                              STREAM(44): HEADERS
                              :status = 200
                              capsule-protocol = ?1

DATAGRAM
Quarter Stream ID = 11
Context ID = 0
Payload = Encapsulated Ethernet Frame

                              DATAGRAM
                              Quarter Stream ID = 11
                              Context ID = 0
                              Payload = Encapsulated Ethernet Frame
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-vpn-full-tunnel-example" class="selfRef">VPN Full-Tunnel Example</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="site-to-site-l2vpn">
<section id="section-8.2">
        <h3 id="name-site-to-site-l2vpn">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-site-to-site-l2vpn" class="section-name selfRef">Site-to-Site L2VPN</a>
        </h3>
<p id="section-8.2-1">The following example shows a site-to-site VPN setup where a client
joins a locally attached broadcast domain to a remote broadcast domain
through the Proxy.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<span id="name-site-to-site-l2vpn-example"></span><div id="diagram-s2s">
<figure id="figure-8">
          <div id="section-8.2-2.1">
            <div class="alignLeft art-svg artwork" id="section-8.2-2.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="256" width="432" viewBox="0 0 432 256" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 80,32 L 80,96" fill="none" stroke="black"></path>
                <path d="M 96,96 L 96,192" fill="none" stroke="black"></path>
                <path d="M 152,32 L 152,96" fill="none" stroke="black"></path>
                <path d="M 280,32 L 280,96" fill="none" stroke="black"></path>
                <path d="M 336,96 L 336,192" fill="none" stroke="black"></path>
                <path d="M 352,32 L 352,96" fill="none" stroke="black"></path>
                <path d="M 80,32 L 152,32" fill="none" stroke="black"></path>
                <path d="M 280,32 L 352,32" fill="none" stroke="black"></path>
                <path d="M 152,48 L 280,48" fill="none" stroke="black"></path>
                <path d="M 160,64 L 176,64" fill="none" stroke="black"></path>
                <path d="M 256,64 L 272,64" fill="none" stroke="black"></path>
                <path d="M 152,80 L 280,80" fill="none" stroke="black"></path>
                <path d="M 80,96 L 152,96" fill="none" stroke="black"></path>
                <path d="M 280,96 L 352,96" fill="none" stroke="black"></path>
                <path d="M 64,128 L 96,128" fill="none" stroke="black"></path>
                <path d="M 336,128 L 368,128" fill="none" stroke="black"></path>
                <path d="M 64,160 L 96,160" fill="none" stroke="black"></path>
                <path d="M 336,160 L 368,160" fill="none" stroke="black"></path>
                <path d="M 64,192 L 96,192" fill="none" stroke="black"></path>
                <path d="M 336,192 L 368,192" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="376,192 364,186.4 364,197.6" fill="black" transform="rotate(0,368,192)"></polygon>
                <polygon class="arrowhead" points="376,160 364,154.4 364,165.6" fill="black" transform="rotate(0,368,160)"></polygon>
                <polygon class="arrowhead" points="376,128 364,122.4 364,133.6" fill="black" transform="rotate(0,368,128)"></polygon>
                <polygon class="arrowhead" points="72,192 60,186.4 60,197.6" fill="black" transform="rotate(180,64,192)"></polygon>
                <polygon class="arrowhead" points="72,160 60,154.4 60,165.6" fill="black" transform="rotate(180,64,160)"></polygon>
                <polygon class="arrowhead" points="72,128 60,122.4 60,133.6" fill="black" transform="rotate(180,64,128)"></polygon>
                <g class="text">
                  <text x="316" y="52">L2</text>
                  <text x="116" y="68">Client</text>
                  <text x="188" y="68">L2</text>
                  <text x="228" y="68">Tunnel</text>
                  <text x="320" y="68">Proxy</text>
                  <text x="20" y="132">HOST</text>
                  <text x="48" y="132">A</text>
                  <text x="128" y="132">Layer</text>
                  <text x="160" y="132">2</text>
                  <text x="288" y="132">Layer</text>
                  <text x="320" y="132">2</text>
                  <text x="396" y="132">HOST</text>
                  <text x="424" y="132">1</text>
                  <text x="144" y="148">Broadcast</text>
                  <text x="288" y="148">Broadcast</text>
                  <text x="20" y="164">HOST</text>
                  <text x="48" y="164">B</text>
                  <text x="132" y="164">Domain</text>
                  <text x="300" y="164">Domain</text>
                  <text x="396" y="164">HOST</text>
                  <text x="424" y="164">2</text>
                  <text x="20" y="196">HOST</text>
                  <text x="48" y="196">C</text>
                  <text x="396" y="196">HOST</text>
                  <text x="424" y="196">3</text>
                </g>
              </svg><a href="#section-8.2-2.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-site-to-site-l2vpn-example" class="selfRef">Site-to-site L2VPN Example</a>
          </figcaption></figure>
</div>
<p id="section-8.2-3">In this case, the client connects to the Ethernet proxy and immediately can
start relaying Ethernet frames from its attached broadcast domain to the
proxy. The difference between this example and <a href="#example-remote" class="auto internal xref">Section 8.1</a> is limited to
what the Client is doing with the the tunnel; the exchange between the Client
and the Proxy is the same as in <a href="#fig-full-tunnel" class="auto internal xref">Figure 7</a> above.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="performance-considerations">
<section id="section-9">
      <h2 id="name-performance-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance Considerations</a>
      </h2>
<p id="section-9-1">When the protocol running inside the tunnel uses congestion control (e.g.,
<span>[<a href="#TCP" class="cite xref">TCP</a>]</span> or <span>[<a href="#QUIC" class="cite xref">QUIC</a>]</span>), the proxied traffic will incur at least two nested
congestion controllers. Implementers will benefit from reading the guidance in
<span><a href="https://rfc-editor.org/rfc/rfc8085#section-3.1.11" class="relref">Section 3.1.11</a> of [<a href="#UDP-USAGE" class="cite xref">UDP-USAGE</a>]</span>. By default the tunneling of Ethernet
frames <span class="bcp14">MUST NOT</span> assume that the carried Ethernet frames contain congestion
controlled traffic. Optimizations for traffic flows carried within the Ethernet
Frames <span class="bcp14">MAY</span> be done in cases where the content of the Ethernet Frames have been
identified to be congestion controlled traffic.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Some implementations might find it benefitial to maintain a small buffer of
frames to be sent through the tunnel to smooth out short term variations and
bursts in tunnel capacity. Any such buffer <span class="bcp14">MUST</span> be limited, and when exceeded
any Ethernet frames that would otherwise be buffered <span class="bcp14">MUST</span> be dropped.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">When the protocol running inside the tunnel uses loss recovery (e.g., <span>[<a href="#TCP" class="cite xref">TCP</a>]</span> or
<span>[<a href="#QUIC" class="cite xref">QUIC</a>]</span>) and the outer HTTP connection runs over TCP, the proxied traffic will
incur at least two nested loss recovery mechanisms. This can reduce performance,
as both can sometimes independently retransmit the same data. To avoid this,
Ethernet proxying <span class="bcp14">SHOULD</span> be performed over HTTP/3 to allow leveraging the QUIC
DATAGRAM frame.<a href="#section-9-3" class="pilcrow">¶</a></p>
<div id="mtu-and-frame-ordering-considerations">
<section id="section-9.1">
        <h3 id="name-mtu-and-frame-ordering-cons">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-mtu-and-frame-ordering-cons" class="section-name selfRef">MTU and Frame Ordering Considerations</a>
        </h3>
<p id="section-9.1-1">When using HTTP/3 with the QUIC Datagram extension <span>[<a href="#QUIC-DGRAM" class="cite xref">QUIC-DGRAM</a>]</span>,
Ethernet frames can be transmitted in QUIC DATAGRAM frames. Since DATAGRAM
frames cannot be fragmented, they can only carry Ethernet frames up to a given
length determined by the QUIC connection configuration and the Path MTU
(PMTU). Implementations <span class="bcp14">MAY</span> rely on <span>[<a href="#QUIC" class="cite xref">QUIC</a>]</span>'s use of <span>[<a href="#DPLPMTUD" class="cite xref">DPLPMTUD</a>]</span> to
probe and discover the PMTU over the connection's lifetime, and adjust any
associated interface MTU as needed. Furthermore, the UDP packets carrying these
frames could be reordered by the network.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">When using HTTP/1.1 or HTTP/2, and when using HTTP/3 without the QUIC Datagram
extension <span>[<a href="#QUIC-DGRAM" class="cite xref">QUIC-DGRAM</a>]</span>, Ethernet frames are transmitted in DATAGRAM capsules as
defined in <span>[<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>. DATAGRAM capsules are transmitted reliably over an
underlying stream, maintaining frame order, though they could be split across
multiple QUIC or TCP packets.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">The trade-off between supporting a larger MTU and avoiding fragmentation should
be considered when deciding what mode(s) to operate in. Implementations <span class="bcp14">SHOULD NOT</span> intentionally reorder Ethernet frames, but are not required to provide
guaranteed in-order delivery. If in-order delivery of Ethernet frames is
required, DATAGRAM capsules can be used.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="vlan-recommendations">
<section id="section-9.2">
        <h3 id="name-ieee-8021q-vlan-tagging">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-ieee-8021q-vlan-tagging" class="section-name selfRef">IEEE 802.1Q VLAN tagging</a>
        </h3>
<p id="section-9.2-1">While the protocol as described can proxy Ethernet frames with IEEE 802.1Q VLAN
tags, it is <span class="bcp14">RECOMMENDED</span> that individual VLANs be proxied in separate
connections, and VLAN tags be stripped and applied by the Ethernet proxying
endpoints as needed.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-10">
      <h2 id="name-security-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-10-1">There are risks in allowing arbitrary clients to establish a tunnel to a Layer 2
network. Bad actors could abuse this capability to attack hosts on that network
that they would otherwise be unable to reach. HTTP servers that support Ethernet
proxying <span class="bcp14">SHOULD</span> restrict its use to authenticated users. Depending on the
deployment, possible authentication mechanisms include mutual TLS between IP
proxying endpoints, HTTP-based authentication via the HTTP Authorization header
<span>[<a href="#HTTP" class="cite xref">HTTP</a>]</span>, or even bearer tokens. Proxies can enforce policies for authenticated
users to further constrain client behavior or deal with possible abuse. For
example, proxies can rate limit individual clients that send an excessively
large amount of traffic through the proxy.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">Users of this protocol may send arbitrary Ethernet frames through the tunnel,
including frames with arbitrary source MAC addresses. This could allow
impersonation of other hosts, poisoning of ARP <span>[<a href="#RFC826" class="cite xref">RFC826</a>]</span>, NDP <span>[<a href="#RFC4861" class="cite xref">RFC4861</a>]</span> and
CAM (Content Addressable Memory) tables, and cause a denial of service to other
hosts on the network. These are the same attacks available to an arbitrary
client with physical access to the network. An implementation that is intended
for point-to-site connections might limit clients to a single source MAC
address, or Ethernet proxying endpoints might be configured to limit forwarding
to pre-configured MAC addresses, though such filtering is outside the scope of
this protocol. Dynamic signalling or negotiation of MAC address filtering is
left to future extensions.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">This protocol is agnostic to where on the Ethernet segment a gateway for
higher-level routing might be located. A client may connect via an Ethernet
proxy and discover an existing gateway on the Ethernet segment, supply a new
gateway to the Ethernet segment, both, or neither.<a href="#section-10-3" class="pilcrow">¶</a></p>
<p id="section-10-4">Opportunistic sending of Ethernet frames is not allowed in HTTP/1.x
because a server could reject the HTTP Upgrade and attempt to parse
the Ethernet frames as a subsequent HTTP request, allowing request
smuggling attacks; see
<span>[<a href="#OPTIMISTIC" class="cite xref">OPTIMISTIC</a>]</span>. In
particular, an intermediary that re-encodes a request from HTTP/2 or 3
to HTTP/1.1 <span class="bcp14">MUST NOT</span> forward any received capsules until it has parsed
a successful Ethernet proxying response.<a href="#section-10-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="http-upgrade-token">
<section id="section-11.1">
        <h3 id="name-http-upgrade-token">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-http-upgrade-token" class="section-name selfRef">HTTP Upgrade Token</a>
        </h3>
<p id="section-11.1-1">This document will request IANA to register "connect-ethernet" in the HTTP
Upgrade Token Registry maintained at
&lt;<span><a href="https://www.iana.org/assignments/http-upgrade-tokens">https://www.iana.org/assignments/http-upgrade-tokens</a></span>&gt;.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlCompact dlParallel" id="section-11.1-2">
          <dt id="section-11.1-2.1">Value:</dt>
          <dd style="margin-left: 1.5em" id="section-11.1-2.2">
            <p id="section-11.1-2.2.1">connect-ethernet<a href="#section-11.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-11.1-2.3">Description:</dt>
          <dd style="margin-left: 1.5em" id="section-11.1-2.4">
            <p id="section-11.1-2.4.1">Proxying of Ethernet Payloads<a href="#section-11.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-11.1-2.5">Expected Version Tokens:</dt>
          <dd style="margin-left: 1.5em" id="section-11.1-2.6">
            <p id="section-11.1-2.6.1">None<a href="#section-11.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-11.1-2.7">References:</dt>
          <dd style="margin-left: 1.5em" id="section-11.1-2.8">
            <p id="section-11.1-2.8.1">This document<a href="#section-11.1-2.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="iana-suffix">
<section id="section-11.2">
        <h3 id="name-updates-to-the-masque-uri-s">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-updates-to-the-masque-uri-s" class="section-name selfRef">Updates to the MASQUE URI Suffixes Registry</a>
        </h3>
<p id="section-11.2-1">This document will request IANA to register "ethernet" in the MASQUE URI
Suffixes Registry maintained at &lt;<span><a href="https://www.iana.org/assignments/masque">https://www.iana.org/assignments/masque</a></span>&gt;,
created by <span><a href="https://rfc-editor.org/rfc/rfc9484#section-12.2" class="relref">Section 12.2</a> of [<a href="#CONNECT-IP" class="cite xref">CONNECT-IP</a>]</span>.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<span id="name-new-masque-uri-suffixes"></span><div id="iana-suffixes-table">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-new-masque-uri-suffixes" class="selfRef">New MASQUE URI Suffixes</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Path Segment</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ethernet</td>
              <td class="text-left" rowspan="1" colspan="1">Ethernet Proxying</td>
              <td class="text-left" rowspan="1" colspan="1">This Document</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="CONNECT-IP">[CONNECT-IP]</dt>
        <dd>
<span class="refAuthor">Pauly, T., Ed.</span>, <span class="refAuthor">Schinazi, D.</span>, <span class="refAuthor">Chernyakhovsky, A.</span>, <span class="refAuthor">Kühlewind, M.</span>, and <span class="refAuthor">M. Westerlund</span>, <span class="refTitle">"Proxying IP in HTTP"</span>, <span class="seriesInfo">RFC 9484</span>, <span class="seriesInfo">DOI 10.17487/RFC9484</span>, <time datetime="2023-10" class="refDate">October 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9484">https://www.rfc-editor.org/rfc/rfc9484</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONNECT-UDP">[CONNECT-UDP]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span>, <span class="refTitle">"Proxying UDP in HTTP"</span>, <span class="seriesInfo">RFC 9298</span>, <span class="seriesInfo">DOI 10.17487/RFC9298</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9298">https://www.rfc-editor.org/rfc/rfc9298</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DPLPMTUD">[DPLPMTUD]</dt>
        <dd>
<span class="refAuthor">Fairhurst, G.</span>, <span class="refAuthor">Jones, T.</span>, <span class="refAuthor">Tüxen, M.</span>, <span class="refAuthor">Rüngeler, I.</span>, and <span class="refAuthor">T. Völker</span>, <span class="refTitle">"Packetization Layer Path MTU Discovery for Datagram Transports"</span>, <span class="seriesInfo">RFC 8899</span>, <span class="seriesInfo">DOI 10.17487/RFC8899</span>, <time datetime="2020-09" class="refDate">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8899">https://www.rfc-editor.org/rfc/rfc8899</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EXT-CONNECT2">[EXT-CONNECT2]</dt>
        <dd>
<span class="refAuthor">McManus, P.</span>, <span class="refTitle">"Bootstrapping WebSockets with HTTP/2"</span>, <span class="seriesInfo">RFC 8441</span>, <span class="seriesInfo">DOI 10.17487/RFC8441</span>, <time datetime="2018-09" class="refDate">September 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8441">https://www.rfc-editor.org/rfc/rfc8441</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EXT-CONNECT3">[EXT-CONNECT3]</dt>
        <dd>
<span class="refAuthor">Hamilton, R.</span>, <span class="refTitle">"Bootstrapping WebSockets with HTTP/3"</span>, <span class="seriesInfo">RFC 9220</span>, <span class="seriesInfo">DOI 10.17487/RFC9220</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9220">https://www.rfc-editor.org/rfc/rfc9220</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP">[HTTP]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9110">https://www.rfc-editor.org/rfc/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP-DGRAM">[HTTP-DGRAM]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">L. Pardue</span>, <span class="refTitle">"HTTP Datagrams and the Capsule Protocol"</span>, <span class="seriesInfo">RFC 9297</span>, <span class="seriesInfo">DOI 10.17487/RFC9297</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9297">https://www.rfc-editor.org/rfc/rfc9297</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="H1">[HTTP/1.1]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP/1.1"</span>, <span class="seriesInfo">STD 99</span>, <span class="seriesInfo">RFC 9112</span>, <span class="seriesInfo">DOI 10.17487/RFC9112</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9112">https://www.rfc-editor.org/rfc/rfc9112</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="H2">[HTTP/2]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span> and <span class="refAuthor">C. Benfield, Ed.</span>, <span class="refTitle">"HTTP/2"</span>, <span class="seriesInfo">RFC 9113</span>, <span class="seriesInfo">DOI 10.17487/RFC9113</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9113">https://www.rfc-editor.org/rfc/rfc9113</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="H3">[HTTP/3]</dt>
        <dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"HTTP/3"</span>, <span class="seriesInfo">RFC 9114</span>, <span class="seriesInfo">DOI 10.17487/RFC9114</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9114">https://www.rfc-editor.org/rfc/rfc9114</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC">[QUIC]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-DGRAM">[QUIC-DGRAM]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Kinnear, E.</span>, and <span class="refAuthor">D. Schinazi</span>, <span class="refTitle">"An Unreliable Datagram Extension to QUIC"</span>, <span class="seriesInfo">RFC 9221</span>, <span class="seriesInfo">DOI 10.17487/RFC9221</span>, <time datetime="2022-03" class="refDate">March 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9221">https://www.rfc-editor.org/rfc/rfc9221</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TCP">[TCP]</dt>
        <dd>
<span class="refAuthor">Eddy, W., Ed.</span>, <span class="refTitle">"Transmission Control Protocol (TCP)"</span>, <span class="seriesInfo">STD 7</span>, <span class="seriesInfo">RFC 9293</span>, <span class="seriesInfo">DOI 10.17487/RFC9293</span>, <time datetime="2022-08" class="refDate">August 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9293">https://www.rfc-editor.org/rfc/rfc9293</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TEMPLATE">[TEMPLATE]</dt>
        <dd>
<span class="refAuthor">Gregorio, J.</span>, <span class="refAuthor">Fielding, R.</span>, <span class="refAuthor">Hadley, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time datetime="2012-03" class="refDate">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6570">https://www.rfc-editor.org/rfc/rfc6570</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="URI">[URI]</dt>
        <dd>
<span class="refAuthor">Berners-Lee, T.</span>, <span class="refAuthor">Fielding, R.</span>, and <span class="refAuthor">L. Masinter</span>, <span class="refTitle">"Uniform Resource Identifier (URI): Generic Syntax"</span>, <span class="seriesInfo">STD 66</span>, <span class="seriesInfo">RFC 3986</span>, <span class="seriesInfo">DOI 10.17487/RFC3986</span>, <time datetime="2005-01" class="refDate">January 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3986">https://www.rfc-editor.org/rfc/rfc3986</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="WELL-KNOWN">[WELL-KNOWN]</dt>
      <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Well-Known Uniform Resource Identifiers (URIs)"</span>, <span class="seriesInfo">RFC 8615</span>, <span class="seriesInfo">DOI 10.17487/RFC8615</span>, <time datetime="2019-05" class="refDate">May 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8615">https://www.rfc-editor.org/rfc/rfc8615</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ETHERIP">[ETHERIP]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span> and <span class="refAuthor">S. Hollenbeck</span>, <span class="refTitle">"EtherIP: Tunneling Ethernet Frames in IP Datagrams"</span>, <span class="seriesInfo">RFC 3378</span>, <span class="seriesInfo">DOI 10.17487/RFC3378</span>, <time datetime="2002-09" class="refDate">September 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3378">https://www.rfc-editor.org/rfc/rfc3378</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GUE">[GUE]</dt>
        <dd>
<span class="refAuthor">Herbert, T.</span>, <span class="refAuthor">Yong, L.</span>, and <span class="refAuthor">O. Zia</span>, <span class="refTitle">"Generic UDP Encapsulation"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-intarea-gue-09</span>, <time datetime="2019-10-26" class="refDate">26 October 2019</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-intarea-gue-09">https://datatracker.ietf.org/doc/html/draft-ietf-intarea-gue-09</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="L2TP">[L2TP]</dt>
        <dd>
<span class="refAuthor">Townsley, W.</span>, <span class="refAuthor">Valencia, A.</span>, <span class="refAuthor">Rubens, A.</span>, <span class="refAuthor">Pall, G.</span>, <span class="refAuthor">Zorn, G.</span>, and <span class="refAuthor">B. Palter</span>, <span class="refTitle">"Layer Two Tunneling Protocol "L2TP""</span>, <span class="seriesInfo">RFC 2661</span>, <span class="seriesInfo">DOI 10.17487/RFC2661</span>, <time datetime="1999-08" class="refDate">August 1999</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2661">https://www.rfc-editor.org/rfc/rfc2661</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="L2TPv3">[L2TPv3]</dt>
        <dd>
<span class="refAuthor">Lau, J., Ed.</span>, <span class="refAuthor">Townsley, M., Ed.</span>, and <span class="refAuthor">I. Goyret, Ed.</span>, <span class="refTitle">"Layer Two Tunneling Protocol - Version 3 (L2TPv3)"</span>, <span class="seriesInfo">RFC 3931</span>, <span class="seriesInfo">DOI 10.17487/RFC3931</span>, <time datetime="2005-03" class="refDate">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3931">https://www.rfc-editor.org/rfc/rfc3931</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OPTIMISTIC">[OPTIMISTIC]</dt>
        <dd>
<span class="refAuthor">Schwartz, B. M.</span>, <span class="refTitle">"Security Considerations for Optimistic Protocol Transitions in HTTP/1.1"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-httpbis-optimistic-upgrade-04</span>, <time datetime="2025-06-11" class="refDate">11 June 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-optimistic-upgrade-04">https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-optimistic-upgrade-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4861">[RFC4861]</dt>
        <dd>
<span class="refAuthor">Narten, T.</span>, <span class="refAuthor">Nordmark, E.</span>, <span class="refAuthor">Simpson, W.</span>, and <span class="refAuthor">H. Soliman</span>, <span class="refTitle">"Neighbor Discovery for IP version 6 (IPv6)"</span>, <span class="seriesInfo">RFC 4861</span>, <span class="seriesInfo">DOI 10.17487/RFC4861</span>, <time datetime="2007-09" class="refDate">September 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4861">https://www.rfc-editor.org/rfc/rfc4861</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC826">[RFC826]</dt>
        <dd>
<span class="refAuthor">Plummer, D.</span>, <span class="refTitle">"An Ethernet Address Resolution Protocol: Or Converting Network Protocol Addresses to 48.bit Ethernet Address for Transmission on Ethernet Hardware"</span>, <span class="seriesInfo">STD 37</span>, <span class="seriesInfo">RFC 826</span>, <span class="seriesInfo">DOI 10.17487/RFC0826</span>, <time datetime="1982-11" class="refDate">November 1982</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc826">https://www.rfc-editor.org/rfc/rfc826</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="UDP-USAGE">[UDP-USAGE]</dt>
      <dd>
<span class="refAuthor">Eggert, L.</span>, <span class="refAuthor">Fairhurst, G.</span>, and <span class="refAuthor">G. Shepherd</span>, <span class="refTitle">"UDP Usage Guidelines"</span>, <span class="seriesInfo">BCP 145</span>, <span class="seriesInfo">RFC 8085</span>, <span class="seriesInfo">DOI 10.17487/RFC8085</span>, <time datetime="2017-03" class="refDate">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8085">https://www.rfc-editor.org/rfc/rfc8085</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">Much of the initial version of this draft borrows heavily from <span>[<a href="#CONNECT-IP" class="cite xref">CONNECT-IP</a>]</span>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">The author would like to thank Alexander Chernyakhovsky and David Schinazi
for their advice while preparing this document, and Etienne Dechamps for
useful discussion on the subject material. Additionally, Mirja Kühlewind,
Magnus Westerlund, and Martin Thompson provided valuable feedback on the
document.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Alejandro R Sedeño</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:asedeno@google.com" class="email">asedeno@google.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
